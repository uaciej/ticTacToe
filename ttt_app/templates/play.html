<!DOCTYPE html>
<html>

<head>
    <title>Play Tic Tac Toe</title>
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js"></script>
    <link rel="stylesheet" href="/static/styles.css">
    <script>
        var socket = io.connect()

        socket.emit('game_start');

        socket.on('move', (data) => {
            const board = data.board;
            updateBoard(board);
            console.log(data);
            if (data.game_over) {
                console.log('game over');
                socket.emit('game_over', { 'winner': data.winner });
                var playAgainBtn = document.getElementById('playAgainBtn');
                playAgainBtn.style.display = 'block'
            }
        });

        socket.on('result', (data) => {
            const winner = data.winner;
            let message;

            if (winner === 'X') {
                message = 'You won!';
            } else if (winner === 'O') {
                message = 'You lost!';
            } else {
                message = 'It\'s a tie!';
            }

            // Display the message
            const resultDiv = document.getElementById('message');
            resultDiv.textContent = message;
        });

    </script>
</head>

<body>
    <h1>Play Tic Tac Toe</h1>
    <div id="message"></div>
    <div class="board">
        <script>
            function updateBoard(board) {
                const boardContainer = document.querySelector('.board');
                boardContainer.innerHTML = '';
                for (let row = 0; row < 3; row++) {
                    for (let col = 0; col < 3; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        cell.dataset.row = row;
                        cell.dataset.col = col;
                        cell.textContent = board[row][col];
                        cell.addEventListener('click', () => handleCellClick(row, col));
                        boardContainer.appendChild(cell);
                    }
                }
            }

            function handleCellClick(row, col) {
                socket.emit('make_move', { row, col });
            }
        </script>
    </div>
    <div id="play_again">
        <button onclick="location.href='/play'" id="playAgainBtn" style="display: none;">Play Again</button>
    </div>
</body>

</html>